{% extends "auctions/layout.html" %}
{% load static %}
{% block body %}

<div class="row" id="product">
    <div class="col-lg-6 img-product">
            <img src="{{auction.image.url}}" alt="connect" style="max-height:600px">
    </div>
    <div class="col-lg-6">
            <p>Author: {{auction.user}}</p>
            <p>Title: {{auction.title}}</p>
            <p>Description: {{auction.description}}</p>
            <p>Category: {{auction.category}}</p>
            <p>Created: {{auction.date}}</p>
            {% if auction.last_bid %}
                <p id="lastBid" class="lastBid{{auction.id}}" value="{{auction.last_bid.bid}}">Current Bid: {{auction.last_bid.bid}}</p>
            {% else %}
                <p id="initialBid" class="lastBid{{auction.id}}" value="{{auction.starting_bid}}">Initial Bid: {{auction.starting_bid}}</p>
            {% endif %}
            {% if request.user != auction.user %}
            <small><span id="smallTotalBid">{{auction.bids.count}}</span> bid(s) so far. <span id="yourLastBid">{% if auction.last_bid.user == request.user %}Your bid is the current bid.{% endif %}</span></small>
            <form id="addBid" data-auction="{{auction.id}}" action="{% url 'bid_to_auction' auction=auction.id %}">
                {% csrf_token %}
                <input type="number" name="totalBid" id="newBid" placeholder="Total bid">
                <button type="submit">Send</button>
            </form>
            {% endif %}
    </div>
    {% if auction.user != request.user %}
        {% if auction not in my_watchlist.auctions.all %}
            <form id="addToWatchlist" action="{% url 'add_to_watchlist' auction=auction.id %}">
                {% csrf_token %}
                <button class="btn btn-dark" type="submit">Add to Watchlist</button>
            </form>   
        {% endif %}
    {% endif %}

    {% if auction.user == request.user %}
        <a href="{% url 'delete_auction' auction=auction.id %}">Delete</a> 
    {% endif %}
    <hr>
</div>
<div class="row">
    {% if auction.comments %}
        {% for comment in auction.comments.all %}
        <div class="comment">
            <small>{{comment.user}}</small>
            <p>{{comment.comment}}</p>
            <small>{{comment.date}}</small>
        </div>
        {% endfor %}
    {% endif %}

    <div class="form-group add-comment">
        <form id="addComment" action="{% url 'add_comment' auction=auction.id %}">
            {% csrf_token %}
            <label class="form-check-label" for="commentToAdd"><strong>Leave a comment</strong></label>
            <textarea class="form-control" rows="3" id="commentToAdd" name="comment"></textarea>
            <button class="btn btn-info" type="submit">Submit</button>
        </form>
    </div>
</div>
{% endblock %}