{% extends "auctions/layout.html" %}
{% load static %}
{% block body %}

<div class="row" id="product">
    <div class="col-lg-6 img-product">
            <img class="img-fluid" src="{{auction.image.url}}" alt="connect" style="max-height:600px">
            <p class="product product-description product-user">{{auction.user|title}}</p>
            <p class="product product-description product-category"><a class="nav-link category-link" href="{% url 'category' category=auction.category.name person=auction.person.person %}">{{auction.category}}</a></p>
            <p class="product product-description product-date">{{auction.datepublished}}</p>
    </div>
    <div class="col-lg-6 acution-description">
            <p class="product-title"><i>{{auction.title}}</i></p>
            <p class="product-description">{{auction.description}}</p>
            {% if auction.last_bid %}
                <p id="lastBid" class="lastBid{{auction.id}} product-description product" value="{{auction.last_bid.bid}}"><strong>Current Bid: {{auction.last_bid.bid}}</strong></p>
            {% else %}
                <p id="initialBid" class="lastBid{{auction.id}} product-description product" value="{{auction.starting_bid}}"><strong>Initial Bid: {{auction.starting_bid}}</strong></p>
            {% endif %}
            {% if request.user != auction.user %}
            <small class="product product-bid"><span id="smallTotalBid">{{auction.bids.count}}</span> bid(s) so far. <span id="yourLastBid">{% if auction.last_bid.user == request.user %}Your bid is the current bid.{% endif %}</span></small>
            <div class="row">
                <form id="addBid" data-auction="{{auction.id}}" action="{% url 'bid_to_auction' auction=auction.id %}">
                    {% csrf_token %}
                    <input type="number" name="totalBid" id="newBid" placeholder="Total bid">
                    <button class="button-auction" type="submit">Send</button>
                </form>
                {% endif %}
                {% if auction.user != request.user %}
                    {% if auction not in my_watchlist.auctions.all %}
                        <form id="addToWatchlist" action="{% url 'add_to_watchlist' auction=auction.id %}">
                            {% csrf_token %}
                            <button id="button-auction" class="button-auction" type="submit"><i id="heart" class="fa fa-heart-o"></i></button>
                        </form>   
                    {% else %}
                        <form id="addToWatchlist" action="{% url 'add_to_watchlist' auction=auction.id %}">
                            {% csrf_token %}
                            <button id="button-auction" class="button-auction added" type="submit"><i id="heart" style="color:red;" class="fa fa-heart-o"></i></button>
                        </form> 
                    {% endif %}
                {% endif %}
            </div>
    </div>
    {% if auction.user == request.user %}
        <a href="{% url 'delete_auction' auction=auction.id %}">Delete</a> 
    {% endif %}
    <hr>
</div>
<div class="row">
    <div class="form-group add-comment">
        <form id="addComment" action="{% url 'add_comment' auction=auction.id %}">
            {% csrf_token %}
            <label class="form-check-label" for="commentToAdd"><strong>Leave a comment</strong></label>
            <textarea class="form-control" id="commentToAdd" name="comment"></textarea>
            <button class="btn btn-info" type="submit">Submit</button>
        </form>
    </div>
</div>
<div class="row">
    {% if auction.comments %}
        {% for comment in auction.comments.all %}
        <div class="comment">
            <small>{{comment.user}}</small>
            <p>{{comment.comment}}</p>
            <small>{{comment.date}}</small>
        </div>
        {% endfor %}
    {% endif %}
</div>
{% endblock %}